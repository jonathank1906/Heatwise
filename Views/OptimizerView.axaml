<UserControl
    x:Class="Sem2Proj.Views.OptimizerView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ScottPlot="clr-namespace:ScottPlot.Avalonia;assembly=ScottPlot.Avalonia"
    xmlns:conv="clr-namespace:Sem2Proj.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:Sem2Proj.ViewModels"
    d:DesignHeight="450"
    d:DesignWidth="800"
    x:DataType="vm:OptimizerViewModel"
    Background="#1e1e1e"
    mc:Ignorable="d">

    <Design.DataContext>
        <vm:OptimizerViewModel />
    </Design.DataContext>

    <UserControl.Resources>
        <conv:EnumToBoolConverter x:Key="EnumToBoolConverter" />
    </UserControl.Resources>

    <UserControl.Styles>
        <!--  Fancy RadioButton Style with circle indicator  -->
        <Style Selector="RadioButton.fancy">
            <Setter Property="Background" Value="#2d2d2d" />
            <Setter Property="BorderBrush" Value="#3e3e3e" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Margin" Value="0,5" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="10,8,15,8" />
            <Setter Property="MinWidth" Value="120" />
            <Setter Property="Template">
                <ControlTemplate>
                    <Border
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="{TemplateBinding CornerRadius}">
                        <DockPanel>
                            <!--  Radio button circle  -->
                            <Border
                                Width="20"
                                Height="20"
                                Margin="5,0,10,0"
                                VerticalAlignment="Center"
                                DockPanel.Dock="Left">
                                <Ellipse
                                    x:Name="radioMark"
                                    Width="16"
                                    Height="16"
                                    Fill="Transparent"
                                    Stroke="#7e7e7e"
                                    StrokeThickness="2" />
                            </Border>
                            <!--  Content  -->
                            <ContentPresenter VerticalAlignment="Center" Content="{TemplateBinding Content}" />
                        </DockPanel>
                    </Border>
                </ControlTemplate>
            </Setter>
        </Style>

        <Style Selector="RadioButton.fancy:pointerover">
            <Setter Property="Background" Value="#3a3a3a" />
            <Setter Property="BorderBrush" Value="#4e4e4e" />
        </Style>

        <Style Selector="RadioButton.fancy:checked">
            <Setter Property="Background" Value="#1a3a5a" />
            <!--  Darker blue background  -->
            <Setter Property="BorderBrush" Value="#0078d7" />
        </Style>

        <!--  Style for the checked radio mark  -->
        <Style Selector="RadioButton.fancy:checked /template/ Ellipse#radioMark">
            <Setter Property="Fill" Value="#0078d7" />
            <Setter Property="Stroke" Value="#005a9e" />
        </Style>

        <Style Selector="ToolTip">
            <Setter Property="Background" Value="White" />
            <Setter Property="Foreground" Value="Black" />
            <Setter Property="BorderBrush" Value="#CCCCCC" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="8" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="FontSize" Value="12" />
        </Style>
    </UserControl.Styles>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <Button
            Grid.Column="0"
            Width="30"
            Height="30"
            Margin="5"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            Command="{Binding TriggerPaneCommand}"
            IsVisible="{Binding !IsPaneOpen}"
            ToolTip.Tip="Expand">
            <Button.Styles>
                <Style Selector="Button">
                    <Setter Property="Panel.ZIndex" Value="0" />
                </Style>
            </Button.Styles>
            <PathIcon Data="{StaticResource RightArrow}" />
        </Button>

        <!--  Side Panel  -->
        <Border
            Grid.Column="0"
            Width="{Binding PaneWidth}"
            Background="#252526"
            BorderBrush="LightGray"
            ClipToBounds="True"
            Tag="{Binding IsPaneOpen}">
            <Border.Styles>
                <Style Selector="Border">
                    <Setter Property="Panel.ZIndex" Value="1" />
                </Style>
                <Style Selector="Border[Tag=True]">
                    <Setter Property="Transitions">
                        <Transitions>
                            <DoubleTransition
                                Easing="BackEaseOut"
                                Property="Width"
                                Duration="0:0:0.3" />
                        </Transitions>
                    </Setter>
                </Style>
                <Style Selector="Border[Tag=False]">
                    <Setter Property="Transitions">
                        <Transitions>
                            <DoubleTransition
                                Easing="BackEaseIn"
                                Property="Width"
                                Duration="0:0:0.3" />
                        </Transitions>
                    </Setter>
                </Style>
            </Border.Styles>

            <Grid>
                <StackPanel
                    Margin="0,50,0,0"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Top"
                    Spacing="10">

                    <TextBlock
                        Margin="0,0,0,10"
                        FontSize="22"
                        FontWeight="Bold"
                        Text="Optimization Settings" />

                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            FontSize="18"
                            FontWeight="SemiBold"
                            Text="Preset" />
                        <Image
                            Width="20"
                            Height="20"
                            Margin="10,0,0,0"
                            Source="{SvgImage Assets/info-circle.svg}"
                            ToolTip.Tip="Select a preset configuration." />
                    </StackPanel>

                    <ItemsControl ItemsSource="{Binding Presets}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Spacing="10" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <RadioButton
                                    Classes="fancy"
                                    Command="{Binding SelectPresetCommand}"
                                    CommandParameter="{Binding}"
                                    Content="{Binding Name}"
                                    GroupName="PresetGroup"
                                    IsChecked="{Binding IsPresetSelected}" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <Border
                        Height="1"
                        Margin="0,10,0,10"
                        Background="#CCCCCC"
                        Opacity="0.5" />
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            FontSize="18"
                            FontWeight="SemiBold"
                            Text="Source Data" />
                        <Image
                            Width="20"
                            Height="20"
                            Margin="10,0,0,0"
                            Source="{SvgImage Assets/info-circle.svg}"
                            ToolTip.Tip="Select the source data for optimization." />
                    </StackPanel>
                    <RadioButton
                        Classes="fancy"
                        Content="Summer"
                        GroupName="SeasonGroup"
                        IsChecked="{Binding IsSummerSelected}" />
                    <RadioButton
                        Classes="fancy"
                        Content="Winter"
                        GroupName="SeasonGroup"
                        IsChecked="{Binding IsWinterSelected}" />

                    <Border
                        Height="1"
                        Margin="0,10,0,10"
                        Background="#CCCCCC"
                        Opacity="0.5" />
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            FontSize="18"
                            FontWeight="SemiBold"
                            Text="Operation Mode" />
                        <Image
                            Width="20"
                            Height="20"
                            Margin="10,0,0,0"
                            Source="{SvgImage Assets/info-circle.svg}"
                            ToolTip.Tip="Optimize for lowest heat production costs or lowest CO₂ emissions." />
                    </StackPanel>
                    <RadioButton
                        Classes="fancy"
                        Content="Cost"
                        GroupName="OptimizationGroup"
                        IsChecked="{Binding IsCostSelected}" />
                    <RadioButton
                        Classes="fancy"
                        Content="CO₂"
                        GroupName="OptimizationGroup"
                        IsChecked="{Binding IsCO2Selected}" />

                    <Button
                        Width="110"
                        Height="50"
                        Margin="0,20,0,0"
                        HorizontalAlignment="Center"
                        Classes="FancyGreenButton"
                        Command="{Binding OptimizeAndPlotCommand}"
                        Content="Optimize" />
                </StackPanel>

                <Button
                    Grid.Column="0"
                    Width="30"
                    Height="30"
                    Margin="0,5,5,0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Command="{Binding TriggerPaneCommand}"
                    IsVisible="{Binding IsPaneOpen}"
                    ToolTip.Tip="Collapse">
                    <PathIcon Data="{StaticResource LeftArrow}" />
                </Button>
            </Grid>
        </Border>

        <!--  Main Content Area  -->
        <Border Grid.Column="1" Background="#1e1e1e">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Grid Grid.Column="0">
                    <Grid>
                        <ScottPlot:AvaPlot
                            x:Name="OptimizationPlot"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            IsVisible="{Binding HasOptimized}" />

                        <TextBlock
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            FontSize="18"
                            Foreground="White"
                            IsVisible="{Binding !HasOptimized}"
                            Text="Click Optimize to get started" />
                    </Grid>
                </Grid>

                <!--  Vertical Toolbar  -->
                <Border
                    Grid.Column="1"
                    Width="40"
                    Background="#252526"
                    BorderBrush="#3e3e3e"
                    BorderThickness="1,0,0,0">
                    <StackPanel
                        Margin="0,10,0,0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Top"
                        Spacing="10">

                        <Button Classes="toolbar" ToolTip.Tip="Change graph type">
                            <Button.Flyout>
                                <Flyout Placement="LeftEdgeAlignedTop">
                                    <StackPanel Width="200" Spacing="5">
                                        <TextBlock
                                            Margin="5,5,5,0"
                                            FontSize="16"
                                            FontWeight="Bold"
                                            Text="Select Graph Type" />

                                        <RadioButton
                                            Classes="fancy"
                                            Content="Heat Production"
                                            GroupName="GraphTypeGroup"
                                            IsChecked="{Binding SelectedGraphType, Converter={StaticResource EnumToBoolConverter}, ConverterParameter={x:Static vm:OptimizerViewModel+GraphType.HeatProduction}}" />

                                        <RadioButton
                                            Classes="fancy"
                                            Content="Production Costs"
                                            GroupName="GraphTypeGroup"
                                            IsChecked="{Binding SelectedGraphType, Converter={StaticResource EnumToBoolConverter}, ConverterParameter={x:Static vm:OptimizerViewModel+GraphType.ProductionCosts}}" />

                                        <RadioButton
                                            Classes="fancy"
                                            Content="Electricity Prices"
                                            GroupName="GraphTypeGroup"
                                            IsChecked="{Binding SelectedGraphType, Converter={StaticResource EnumToBoolConverter}, ConverterParameter={x:Static vm:OptimizerViewModel+GraphType.ElectricityPrices}}" />

                                        <RadioButton
                                            Classes="fancy"
                                            Content="Electricity Production"
                                            GroupName="GraphTypeGroup" />

                                        <RadioButton
                                            Classes="fancy"
                                            Content="Electricity Consumption"
                                            GroupName="GraphTypeGroup" />

                                        <RadioButton
                                            Classes="fancy"
                                            Content="Fuel Consumption"
                                            GroupName="GraphTypeGroup" />

                                        <RadioButton
                                            Classes="fancy"
                                            Content="CO₂ Emissions"
                                            GroupName="GraphTypeGroup"
                                            IsChecked="{Binding SelectedGraphType, Converter={StaticResource EnumToBoolConverter}, ConverterParameter={x:Static vm:OptimizerViewModel+GraphType.CO2Emissions}}" />

                                        <RadioButton
                                            Classes="fancy"
                                            Content="Expenses and Profit"
                                            GroupName="GraphTypeGroup" />
                                    </StackPanel>
                                </Flyout>
                            </Button.Flyout>
                            <StackPanel
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Orientation="Vertical">
                                <Image
                                    Width="25"
                                    Height="25"
                                    Source="{SvgImage Assets/swapgraphs.svg}" />
                            </StackPanel>
                        </Button>

                        <Button
                            x:Name="CalendarButton"
                            Classes="toolbar"
                            ToolTip.Tip="Calendar">
                            <Button.Flyout>
                                <Flyout Placement="LeftEdgeAlignedTop">
                                    <StackPanel Width="300" Spacing="5">
                                        <TextBlock
                                            Margin="5,5,5,0"
                                            FontSize="16"
                                            FontWeight="Bold"
                                            Text="Select Date Range" />
                                        <Calendar
                                            x:Name="OptimizationCalendar"
                                            Background="#2d2d2d"
                                            BorderBrush="#3e3e3e"
                                            BorderThickness="5,5,5,5"
                                            CornerRadius="15,15,15,15"
                                            Foreground="White"
                                            SelectionMode="MultipleRange" />
                                        <Button
                                            Width="100"
                                            Margin="0,10,0,0"
                                            HorizontalAlignment="Center"
                                            Click="SetDateRange_Click"
                                            Content="Apply" />
                                    </StackPanel>
                                </Flyout>
                            </Button.Flyout>
                            <StackPanel
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Orientation="Vertical">
                                <Image
                                    Width="22"
                                    Height="22"
                                    Source="{SvgImage Assets/calendar.svg}" />
                            </StackPanel>
                        </Button>


                        <Button Classes="toolbar" ToolTip.Tip="Toggle visibility">
                            <Button.Flyout>
                                <Flyout Placement="LeftEdgeAlignedTop">
                                    <Panel Width="130" Height="100">
                                        <CheckBox
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Center"
                                            Content="Heat Demand"
                                            IsChecked="{Binding ShowHeatDemand}" />
                                    </Panel>
                                </Flyout>
                            </Button.Flyout>
                            <PathIcon Data="{StaticResource Layers}" />
                        </Button>


                        <Button
                            Classes="toolbar"
                            Command="{Binding ResetViewCommand}"
                            ToolTip.Tip="Restore view">
                            <PathIcon Data="{StaticResource Home}" />
                        </Button>


                        <Button
                            Classes="toolbar"
                            Click="ToggleTooltip_Click"
                            ToolTip.Tip="Pointer">
                            <StackPanel
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Orientation="Vertical">
                                <Image
                                    Width="22"
                                    Height="22"
                                    Source="{SvgImage Assets/pointer.svg}" />
                            </StackPanel>
                        </Button>

                        <Button
                            Classes="toolbar"
                            Click="OnExportButtonClick"
                            ToolTip.Tip="Export optimized results to a CSV file">
                            <PathIcon Data="{StaticResource Export}" />
                        </Button>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>
